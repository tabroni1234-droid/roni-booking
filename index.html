<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Roniï½œå¥é«”é¡§å•é ç´„ç³»çµ±</title>
    <meta property="og:title" content="Roniï½œå¥é«”é¡§å•é ç´„ç³»çµ±">
    <meta property="og:description" content="å°ˆå±¬ä¸€å°ä¸€å¥é«”é¡§å•ï¼Œé»æ“Šç«‹å³é ç´„è«®è©¢æ™‚æ®µã€‚">
    <meta property="og:image" content="https://ronifitnessfactory.netlify.app/avatar.png"> <meta property="og:url" content="https://ronifitnessfactory.netlify.app/">
    <meta property="og:type" content="website">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- V15.0 å®Œç¾åŒæ­¥ç‰ˆ --- */
        :root {
            --bg-color: #050505;
            --card-bg: #121212;
            --primary-gold: #C5A059;
            --gold-gradient: linear-gradient(135deg, #C5A059 0%, #9A7B3A 100%);
            --input-bg: #1a1a1a;
            --border-color: #333;
        }
        body { background-color: var(--bg-color); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 20px 15px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 480px; background: var(--card-bg); padding: 30px 25px; border-radius: 16px; border: 1px solid var(--border-color); margin-bottom: 40px; position: relative; z-index: 10; }
        header { text-align: center; margin-bottom: 30px; }
        .avatar-box { width: 110px; height: 110px; margin: 0 auto 20px; border-radius: 50%; border: 2px solid var(--primary-gold); padding: 4px; background: #000; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .avatar-box img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        .fallback-icon { display: none; font-size: 50px; color: #444; }
        h1 { color: var(--primary-gold); font-size: 22px; margin: 0 0 5px 0; letter-spacing: 1px; }
        p.subtitle { color: #888; font-size: 12px; letter-spacing: 2px; text-transform: uppercase; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--primary-gold); }
        input, select { width: 100%; padding: 12px 15px; background-color: var(--input-bg); border: 1px solid var(--border-color); border-radius: 8px; color: #fff; font-size: 16px; outline: none; box-sizing: border-box; -webkit-appearance: none; }
        select { background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23C5A059' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px; }
        input:focus, select:focus { border-color: var(--primary-gold); box-shadow: 0 0 0 1px var(--primary-gold); }
        .time-area { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 250px; overflow-y: auto; padding: 2px; min-height: 60px; }
        .time-chip { background: #1a1a1a; border: 1px solid #333; padding: 12px; border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s; }
        .time-chip.selected { background: var(--gold-gradient); border-color: var(--primary-gold); color: #000; font-weight: bold; }
        .time-chip.selected span { color: #000 !important; }
        .time-chip.disabled { opacity: 0.3; pointer-events: none; text-decoration: line-through; }
        .btn-submit { width: 100%; padding: 16px; margin-top: 30px; background: var(--gold-gradient) !important; color: #000 !important; font-weight: bold; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; -webkit-appearance: none; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 999; }
        .modal-box { background: #1a1a1a; width: 85%; max-width: 350px; padding: 25px; border-radius: 12px; border: 1px solid var(--primary-gold); text-align: center; }
        .summary-text { text-align: left; background: #000; padding: 15px; border-radius: 6px; margin: 15px 0; font-size: 14px; line-height: 1.6; color: #ccc; }
        .success-icon { font-size: 50px; color: var(--primary-gold); margin-bottom: 15px; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-radius: 50%; border-top: 3px solid var(--primary-gold); width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="avatar-box">
                <img src="avatar.png" alt="Roni" onerror="this.style.display='none'; document.querySelector('.fallback-icon').style.display='block';">
                <i class="fa-solid fa-user fallback-icon"></i>
            </div>
            <h1>Roniï½œå¥é«”é¡§å•é ç´„ç³»çµ±</h1>
            <p class="subtitle">Fitness Consultant Reservation</p>
        </header>
        <form id="bookingForm">
            <div class="form-group"><label>æ‚¨çš„å§“å (Name)</label><input type="text" id="name" placeholder="è«‹è¼¸å…¥å…¨å" required></div>
            <div class="form-group"><label>æ€§åˆ¥ (Gender)</label><select id="gender" required><option value="">è«‹é»æ“Šé¸æ“‡</option><option value="ç”·">ç”· (Male)</option><option value="å¥³">å¥³ (Female)</option></select></div>
            <div class="form-group"><label>æ‰‹æ©Ÿè™Ÿç¢¼ (Phone)</label><input type="tel" id="phone" placeholder="09xxxxxxxx" maxlength="10" required></div>
            <div class="form-group"><label>é ç´„ç›®çš„ (Purpose)</label><select id="purpose" required><option value="">è«‹é»æ“Šé¸æ“‡</option><option value="å…¥æœƒé«”é©—">å…¥æœƒé«”é©—</option><option value="èˆŠå®¢é ç´„">èˆŠå®¢é ç´„</option><option value="è³‡æ–™è£œé½Š">è³‡æ–™è£œé½Š</option></select></div>
            <div class="form-group"><label>é¸æ“‡å» é¤¨ (Factory)</label><select id="factory" required><option value="">è«‹é»æ“Šé¸æ“‡</option><option value="å¥èº«å·¥å» æ°‘é›„å» ">å¥èº«å·¥å» æ°‘é›„å» </option><option value="å¥èº«å·¥å» å˜‰ç¾©å» ">å¥èº«å·¥å» å˜‰ç¾©å» </option></select></div>
            <div class="form-group"><label>é ç´„æ™‚æ®µ (Time)</label><input type="hidden" id="realTimeInput" name="timeSlot"><div class="time-area" id="timeChipsArea"><div class="spinner"></div><div style="text-align:center; font-size:12px; color:#666;">åŒæ­¥é›²ç«¯è³‡æ–™ä¸­...</div></div></div>
            <button type="submit" id="submitBtn" class="btn-submit">ç¢ºèªä¸¦é ç´„</button>
        </form>
    </div>
    <div id="confirmModal" class="modal">
        <div class="modal-box">
            <div id="modalContent">
                <h3 style="color:var(--primary-gold);">ç¢ºèªè³‡è¨Š</h3>
                <div class="summary-text" id="summaryContent"></div>
                <div style="display:flex; gap:10px;">
                    <button type="button" onclick="closeModal('confirmModal')" style="flex:1; padding:10px; background:#333; color:#fff; border:none; border-radius:6px;">ä¿®æ”¹</button>
                    <button type="button" onclick="finalSubmit()" id="finalBtn" style="flex:1; padding:10px; background:var(--primary-gold); color:#000; border:none; border-radius:6px; font-weight:bold;">é€å‡º</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // ==========================================
        // âš ï¸ ä½ çš„ Google Apps Script ç¶²å€ (å·²å¡«å…¥)
        // ==========================================
        const API_URL = "https://script.google.com/macros/s/AKfycbyBNTeC51u7lKbzx_BOFqNwgTwkMoA0HFLN4aOxUPSUaRtErAmtrS-Ml5oM_F9oYCx-EQ/exec"; 

        const WORK_SCHEDULE = [
            "2025-12-16 10:00", "2025-12-16 11:00", "2025-12-16 12:00", "2025-12-16 13:00", "2025-12-16 14:00", "2025-12-16 15:00", "2025-12-16 16:00", "2025-12-16 17:00", "2025-12-16 18:00",
            "2025-12-17 10:00", "2025-12-17 11:00", "2025-12-17 12:00", "2025-12-17 13:00", "2025-12-17 14:00", "2025-12-17 15:00", "2025-12-17 16:00", "2025-12-17 17:00", "2025-12-17 18:00",
            "2025-12-18 10:00", "2025-12-18 11:00", "2025-12-18 12:00", "2025-12-18 13:00", "2025-12-18 14:00", "2025-12-18 15:00", "2025-12-18 16:00", "2025-12-18 17:00", "2025-12-18 18:00",
            "2025-12-19 10:00", "2025-12-19 11:00", "2025-12-19 12:00", "2025-12-19 13:00", "2025-12-19 14:00", "2025-12-19 15:00", "2025-12-19 16:00", "2025-12-19 17:00", "2025-12-19 18:00",
            "2025-12-20 10:00", "2025-12-20 11:00", "2025-12-20 12:00", "2025-12-20 13:00", "2025-12-20 14:00", "2025-12-20 15:00", "2025-12-20 16:00", "2025-12-20 17:00", "2025-12-20 18:00",
            "2025-12-21 10:00", "2025-12-21 11:00", "2025-12-21 12:00", "2025-12-21 13:00", "2025-12-21 14:00", "2025-12-21 15:00", "2025-12-21 16:00", "2025-12-21 17:00", "2025-12-21 18:00",
            "2025-12-23 14:00", "2025-12-23 15:00", "2025-12-23 16:00", "2025-12-23 17:00", "2025-12-23 18:00", "2025-12-23 19:00", "2025-12-23 20:00", "2025-12-23 21:00", "2025-12-23 22:00",
            "2025-12-24 12:00", "2025-12-24 13:00", "2025-12-24 14:00", "2025-12-24 15:00", "2025-12-24 16:00", "2025-12-24 17:00", "2025-12-24 18:00", "2025-12-24 19:00", "2025-12-24 20:00",
            "2025-12-25 10:00", "2025-12-25 11:00", "2025-12-25 12:00", "2025-12-25 13:00", "2025-12-25 14:00", "2025-12-25 15:00", "2025-12-25 16:00", "2025-12-25 17:00", "2025-12-25 18:00",
            "2025-12-26 10:00", "2025-12-26 11:00", "2025-12-26 12:00", "2025-12-26 13:00", "2025-12-26 14:00", "2025-12-26 15:00", "2025-12-26 16:00", "2025-12-26 17:00", "2025-12-26 18:00",
            "2025-12-27 10:00", "2025-12-27 11:00", "2025-12-27 12:00", "2025-12-27 13:00", "2025-12-27 14:00", "2025-12-27 15:00", "2025-12-27 16:00", "2025-12-27 17:00", "2025-12-27 18:00",
            "2025-12-28 10:00", "2025-12-28 11:00", "2025-12-28 12:00", "2025-12-28 13:00", "2025-12-28 14:00", "2025-12-28 15:00", "2025-12-28 16:00", "2025-12-28 17:00", "2025-12-28 18:00"
        ];

        window.onload = function() { fetchBookedSlots(); };

        function fetchBookedSlots() {
            fetch(API_URL)
            .then(res => res.json())
            .then(bookedList => {
                // è³‡æ–™æ¸…æ´—ï¼šç¢ºä¿åªæ¯”å°å­—ä¸²ï¼Œå¿½ç•¥ç©ºç™½
                const cleanList = bookedList.map(item => String(item).trim());
                renderTimeChips(cleanList);
            })
            .catch(err => { renderTimeChips([]); });
        }

        function renderTimeChips(bookedList) {
            const area = document.getElementById('timeChipsArea');
            area.innerHTML = '';
            const now = new Date();
            let count = 0;
            WORK_SCHEDULE.forEach(t => {
                const dateObj = new Date(t);
                if (dateObj <= now) return;
                
                // é€™è£¡æœƒæ¯”å° Google å‚³å›ä¾†çš„å­—ä¸² vs æˆ‘å€‘çš„ç­è¡¨å­—ä¸²
                const isBooked = Array.isArray(bookedList) && bookedList.includes(t);
                const showStr = formatTime(dateObj);
                
                let chip = document.createElement('div');
                chip.className = 'time-chip';
                if(isBooked) {
                    chip.classList.add('disabled');
                    chip.innerHTML = `<span style="display:block; font-size:12px; color:#666;">${showStr.split(' ')[0]}</span><span style="font-size:14px; color:#555;">å·²é ç´„</span>`;
                } else {
                    chip.innerHTML = `<span style="display:block; font-size:12px; color:#aaa;">${showStr.split(' ')[0]} ${showStr.split(' ')[1]}</span><span style="font-size:16px; color:#fff;">${showStr.split(' ')[2]}</span>`;
                    chip.onclick = () => selectChip(chip, t);
                    count++;
                }
                area.appendChild(chip);
            });
            if(count === 0) area.innerHTML = '<div style="grid-column:span 2; text-align:center; color:#666; padding:20px;">ç›®å‰ç„¡å¯é ç´„æ™‚æ®µ</div>';
        }

        function selectChip(el, val) {
            document.querySelectorAll('.time-chip').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('realTimeInput').value = val;
        }

        function formatTime(d) {
            const days = ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
            const MM = d.getMonth()+1;
            const DD = d.getDate();
            const W = days[d.getDay()];
            const HH = String(d.getHours()).padStart(2,'0');
            return `${MM}/${DD} (${W}) ${HH}:00`;
        }

        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const fd = { name: document.getElementById('name').value, gender: document.getElementById('gender').value, phone: document.getElementById('phone').value, purpose: document.getElementById('purpose').value, factory: document.getElementById('factory').value, time: document.getElementById('realTimeInput').value };
            if(!/^\d{10}$/.test(fd.phone)) return alert("æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼éŒ¯èª¤ (éœ€10ç¢¼)");
            if(!fd.time) return alert("è«‹é¸æ“‡é ç´„æ™‚æ®µ");
            const showTime = formatTime(new Date(fd.time));
            window.tempData = { ...fd, showTime };
            document.getElementById('summaryContent').innerText = `å§“åï¼š${fd.name}\næ€§åˆ¥ï¼š${fd.gender}\né›»è©±ï¼š${fd.phone}\nç›®çš„ï¼š${fd.purpose}\nå» é¤¨ï¼š${fd.factory}\næ™‚é–“ï¼š${showTime}`;
            document.getElementById('confirmModal').style.display = 'flex';
        });

        function finalSubmit() {
            const btn = document.getElementById('finalBtn');
            btn.innerText = "è™•ç†ä¸­...";
            btn.disabled = true;
            const data = window.tempData;
            fetch(API_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "text/plain" }, body: JSON.stringify(data) });
            setTimeout(() => { showSuccessAndRedirect(data); }, 800);
        }

        function showSuccessAndRedirect(data) {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `<div style="text-align:center; padding:20px;"><i class="fa-solid fa-circle-check success-icon"></i><h3 style="color:#C5A059; margin:10px 0;">å·²å®Œæˆé ç´„</h3><p style="color:#888; font-size:14px;">è³‡æ–™å·²å‚³é€ï¼Œå³å°‡è·³è½‰ LINE...</p></div>`;
            const text = `ã€Roni é ç´„ã€‘\nğŸ‘¤ ${data.name} (${data.gender})\nğŸ“± ${data.phone}\nğŸ¯ ${data.purpose}\nğŸ¢ ${data.factory}\nğŸ“… ${data.showTime}`;
            navigator.clipboard.writeText(text).catch(()=>{});
            setTimeout(() => { window.location.href = 'https://line.me/ti/p/@781uizhn'; }, 2000);
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        window.onclick = function(e) { if(e.target.classList.contains('modal')) e.target.style.display = 'none'; }
    </script>
</body>
</html>